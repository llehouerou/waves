#!/bin/sh
# Pre-commit hook: format and lint before committing

# Save list of staged files before formatting
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

echo "Running make check..."
make check || exit 1

# Re-add only files that were originally staged (in case formatting modified them)
if [ -n "$STAGED_FILES" ]; then
    echo "$STAGED_FILES" | xargs -r git add
fi
